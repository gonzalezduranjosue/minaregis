<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://lucide.dev/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Gestión de Inventario TI</title>
    <meta name="description" content="Sistema de gestión de inventarios moderno con soporte para Excel y modo oscuro." />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- SheetJS (Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Configuración Tailwind para Dark Mode -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#3b82f6', // Blue 500
              secondary: '#64748b', // Slate 500
            },
            animation: {
              'shake': 'shake 0.82s cubic-bezier(.36,.07,.19,.97) both',
            },
            keyframes: {
              shake: {
                '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
              }
            }
          }
        }
      }
    </script>

    <style>
      /* Transiciones suaves para el cambio de tema */
      body { transition: background-color 0.3s, color 0.3s; }
      .card-transition { transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s; }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.0",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
  <body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
    
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
      import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
      import { 
        LayoutDashboard, Package, Moon, Sun, Upload, Download, 
        Plus, Trash2, Search, Laptop, Monitor, Cpu, Server, 
        LogOut, MoreHorizontal, FileSpreadsheet, HardDrive, Lock, Pencil 
      } from 'https://esm.sh/lucide-react@0.344.0';

      // --- UTILIDADES ---
      const INITIAL_DATA = [
        { id: 1, name: 'Dell Optiplex 7090', type: 'PC', status: 'Operativo', location: 'Recepción', serialNumber: 'CN-0M5F4T' },
        { id: 2, name: 'MacBook Pro M1', type: 'Laptop', status: 'Asignado', location: 'Diseño', serialNumber: 'C02DP0' },
        { id: 3, name: 'Monitor LG Ultrawide', type: 'Periférico', status: 'Mantenimiento', location: 'IT Lab', serialNumber: 'LG-34WN' },
      ];

      // --- COMPONENTE: Login Moderno Seguro ---
      const LoginPage = ({ onLogin }) => {
        const [username, setUsername] = useState('');
        const [error, setError] = useState(false);

        const handleSubmit = (e) => {
          e.preventDefault();
          
          // Validación de seguridad estricta
          if (username.trim().toLowerCase() === 'joshy') {
            onLogin('Joshy'); // Normalizamos el nombre al entrar
          } else {
            setError(true);
            setTimeout(() => setError(false), 800); // Quitar estado de error tras la animación
          }
        };

        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 px-4">
            <div className={`max-w-md w-full bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-8 card-transition ${error ? 'animate-shake border-2 border-red-500' : ''}`}>
              <div className="text-center mb-8">
                <div className={`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 transition-colors ${error ? 'bg-red-100 text-red-500 dark:bg-red-900/30' : 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400'}`}>
                  {error ? <Lock size={32} /> : <Package size={32} />}
                </div>
                <h2 className="text-3xl font-bold text-gray-800 dark:text-white">Inventario TI</h2>
                <p className="text-gray-500 dark:text-gray-400 mt-2">Acceso Restringido</p>
              </div>
              
              <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Usuario Autorizado</label>
                  <input
                    type="text"
                    required
                    autoFocus
                    className={`w-full px-4 py-3 rounded-lg border focus:ring-2 outline-none transition-all dark:bg-gray-700 dark:text-white ${error ? 'border-red-500 focus:ring-red-500 text-red-500' : 'border-gray-300 dark:border-gray-600 focus:ring-blue-500'}`}
                    placeholder="Ingrese su usuario..."
                    value={username}
                    onChange={(e) => {
                      setUsername(e.target.value);
                      setError(false);
                    }}
                  />
                  {error && <p className="text-red-500 text-sm mt-2">⛔ Acceso denegado: Usuario no autorizado.</p>}
                </div>
                <button
                  type="submit"
                  className={`w-full font-semibold py-3 rounded-lg transition-colors shadow-lg ${error ? 'bg-red-600 hover:bg-red-700 text-white shadow-red-500/30' : 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30'}`}
                >
                  {error ? 'Reintentar' : 'Iniciar Sesión Segura'}
                </button>
              </form>
            </div>
          </div>
        );
      };

      // --- COMPONENTE: Dashboard ---
      const Dashboard = ({ user, onLogout }) => {
        const [inventory, setInventory] = useState(() => {
          const saved = localStorage.getItem('modern_inventory');
          return saved ? JSON.parse(saved) : INITIAL_DATA;
        });
        
        const [isDarkMode, setIsDarkMode] = useState(() => {
            return localStorage.getItem('theme') === 'dark';
        });

        const [isModalOpen, setIsModalOpen] = useState(false);
        const [editingId, setEditingId] = useState(null); // Estado para saber si editamos
        const [searchTerm, setSearchTerm] = useState('');
        const fileInputRef = useRef(null);

        // Form State
        const [formData, setFormData] = useState({ name: '', type: 'PC', status: 'Operativo', location: '', serialNumber: '' });

        // Efectos
        useEffect(() => {
          localStorage.setItem('modern_inventory', JSON.stringify(inventory));
        }, [inventory]);

        useEffect(() => {
          if (isDarkMode) {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
          } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          }
        }, [isDarkMode]);

        // --- Funciones Excel ---
        
        const exportExcel = () => {
          const ws = XLSX.utils.json_to_sheet(inventory);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Inventario");
          XLSX.writeFile(wb, "Inventario_TI.xlsx");
        };

        const importExcel = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const bstr = evt.target.result;
              const wb = XLSX.read(bstr, { type: 'binary' });
              const wsname = wb.SheetNames[0];
              const ws = wb.Sheets[wsname];
              const data = XLSX.utils.sheet_to_json(ws);
              
              const cleanData = data.map((item, index) => ({
                id: item.id || Date.now() + index,
                name: item.name || 'Desconocido',
                type: item.type || 'Otro',
                status: item.status || 'Revisar',
                location: item.location || 'Sin asignar',
                serialNumber: item.serialNumber || 'N/A'
              }));

              if (confirm(`Se han encontrado ${cleanData.length} registros. ¿Deseas reemplazar el inventario actual (Aceptar) o agregarlos (Cancelar)?`)) {
                 setInventory(cleanData);
              } else {
                 setInventory([...inventory, ...cleanData]);
              }
              e.target.value = null; 
            } catch (error) {
              alert("Error al leer el archivo. Asegúrate de que sea un Excel válido.");
              console.error(error);
            }
          };
          reader.readAsBinaryString(file);
        };

        // --- CRUD ---

        const handleSave = (e) => {
          e.preventDefault();
          
          if (editingId) {
            // Modo Edición
            setInventory(inventory.map(item => 
              item.id === editingId ? { ...formData, id: editingId } : item
            ));
          } else {
            // Modo Creación
            setInventory([...inventory, { ...formData, id: Date.now() }]);
          }

          closeModal();
        };

        const openNewModal = () => {
          setFormData({ name: '', type: 'PC', status: 'Operativo', location: '', serialNumber: '' });
          setEditingId(null);
          setIsModalOpen(true);
        };

        const openEditModal = (item) => {
          setFormData({
            name: item.name,
            type: item.type,
            status: item.status,
            location: item.location,
            serialNumber: item.serialNumber
          });
          setEditingId(item.id);
          setIsModalOpen(true);
        };

        const closeModal = () => {
          setIsModalOpen(false);
          setEditingId(null);
          setFormData({ name: '', type: 'PC', status: 'Operativo', location: '', serialNumber: '' });
        };

        const handleDelete = (id) => {
          if (confirm('¿Eliminar este equipo permanentemente?')) {
            setInventory(inventory.filter(i => i.id !== id));
          }
        };

        // UI Helpers
        const getIcon = (type) => {
          switch(type) {
            case 'PC': return <Cpu className="text-blue-500" />;
            case 'Laptop': return <Laptop className="text-purple-500" />;
            case 'Servidor': return <Server className="text-green-500" />;
            default: return <Monitor className="text-orange-500" />;
          }
        };

        const getStatusColor = (status) => {
           if (status === 'Operativo') return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300';
           if (status === 'Asignado') return 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300';
           return 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300';
        };

        const filteredInventory = inventory.filter(item => 
          item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          item.serialNumber.toLowerCase().includes(searchTerm.toLowerCase())
        );

        return (
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 pb-20">
            {/* Header */}
            <header className="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-10 card-transition">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <LayoutDashboard className="text-blue-600 dark:text-blue-400" />
                  <h1 className="font-bold text-xl text-gray-800 dark:text-white hidden sm:block">Panel de Control</h1>
                </div>
                
                <div className="flex items-center gap-4">
                  <div className="hidden md:flex items-center gap-2 px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm">
                    <span className="w-2 h-2 rounded-full bg-green-500"></span>
                    <span className="font-medium">{user}</span>
                  </div>
                  
                  <button 
                    onClick={() => setIsDarkMode(!isDarkMode)}
                    className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                    title="Cambiar Tema"
                  >
                    {isDarkMode ? <Sun size={20} className="text-yellow-400"/> : <Moon size={20} className="text-gray-600"/>}
                  </button>

                  <button 
                    onClick={onLogout}
                    className="p-2 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 transition-colors"
                    title="Cerrar Sesión"
                  >
                    <LogOut size={20} />
                  </button>
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              
              {/* Stats Bar */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 card-transition">
                  <p className="text-sm text-gray-500 dark:text-gray-400">Total Equipos</p>
                  <p className="text-3xl font-bold mt-1 text-gray-800 dark:text-white">{inventory.length}</p>
                </div>
                <div className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 card-transition">
                  <p className="text-sm text-gray-500 dark:text-gray-400">Operativos</p>
                  <p className="text-3xl font-bold mt-1 text-green-600 dark:text-green-400">
                    {inventory.filter(i => i.status === 'Operativo').length}
                  </p>
                </div>
                <div className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 card-transition">
                  <p className="text-sm text-gray-500 dark:text-gray-400">En Mantenimiento</p>
                  <p className="text-3xl font-bold mt-1 text-orange-500 dark:text-orange-400">
                    {inventory.filter(i => i.status !== 'Operativo').length}
                  </p>
                </div>
              </div>

              {/* Toolbar */}
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <div className="relative w-full md:w-96">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                  <input 
                    type="text" 
                    placeholder="Buscar por nombre o serie..." 
                    className="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 outline-none transition-all dark:text-white"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                </div>
                
                <div className="flex flex-wrap gap-2 w-full md:w-auto">
                   <button 
                    onClick={openNewModal}
                    className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm"
                  >
                    <Plus size={18} /> Nuevo
                  </button>

                  <button 
                    onClick={exportExcel}
                    className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm"
                  >
                    <FileSpreadsheet size={18} /> Exportar
                  </button>

                  <div className="relative flex-1 md:flex-none">
                    <input 
                      type="file" 
                      accept=".xlsx, .xls"
                      ref={fileInputRef}
                      onChange={importExcel}
                      className="hidden"
                    />
                    <button 
                      onClick={() => fileInputRef.current?.click()}
                      className="w-full flex items-center justify-center gap-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg font-medium transition-colors shadow-sm"
                    >
                      <Upload size={18} /> Importar
                    </button>
                  </div>
                </div>
              </div>

              {/* Grid Cards */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {filteredInventory.map((item) => (
                  <div key={item.id} className="group bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm hover:shadow-md border border-gray-100 dark:border-gray-700 transition-all card-transition flex flex-col">
                    {/* Header: Icon + Status */}
                    <div className="flex justify-between items-start mb-4">
                      <div className="p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        {getIcon(item.type)}
                      </div>
                      <span className={`px-2 py-1 rounded text-xs font-semibold ${getStatusColor(item.status)}`}>
                        {item.status}
                      </span>
                    </div>
                    
                    {/* Body: Info */}
                    <div className="mb-4 flex-grow">
                      <h3 className="font-bold text-lg text-gray-800 dark:text-white mb-1 truncate">{item.name}</h3>
                      <p className="text-sm text-gray-500 dark:text-gray-400">{item.serialNumber}</p>
                    </div>
                    
                    {/* Footer: Location & Actions */}
                    <div className="flex items-center justify-between gap-3 mt-auto pt-4 border-t border-gray-50 dark:border-gray-700/50">
                      <div className="flex-1 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-700/50 p-2 rounded overflow-hidden">
                        <span className="font-medium text-xs uppercase text-gray-400 shrink-0">UBICACIÓN:</span>
                        <span className="truncate">{item.location}</span>
                      </div>

                      <div className="flex gap-2 shrink-0 opacity-100">
                        <button 
                          onClick={() => openEditModal(item)}
                          className="p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors border border-gray-200 dark:border-gray-700"
                          title="Editar"
                        >
                          <Pencil size={18} />
                        </button>
                        <button 
                          onClick={() => handleDelete(item.id)}
                          className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors border border-gray-200 dark:border-gray-700"
                          title="Eliminar"
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {filteredInventory.length === 0 && (
                <div className="text-center py-20 text-gray-400 dark:text-gray-500">
                  <Package size={64} className="mx-auto mb-4 opacity-50" />
                  <p className="text-lg">No se encontraron equipos</p>
                </div>
              )}

            </main>

            {/* Modal de Creación/Edición */}
            {isModalOpen && (
              <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden card-transition">
                  <div className="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                    <h3 className="font-bold text-lg text-gray-800 dark:text-white">
                      {editingId ? 'Editar Equipo' : 'Registrar Nuevo Equipo'}
                    </h3>
                    <button onClick={closeModal} className="text-gray-400 hover:text-gray-600">&times;</button>
                  </div>
                  
                  <form onSubmit={handleSave} className="p-6 space-y-4">
                    <div>
                      <label className="block text-sm text-gray-600 dark:text-gray-400 mb-1">Nombre del Equipo</label>
                      <input 
                        required
                        className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none"
                        value={formData.name}
                        onChange={e => setFormData({...formData, name: e.target.value})}
                      />
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm text-gray-600 dark:text-gray-400 mb-1">Tipo</label>
                        <select 
                          className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white outline-none"
                          value={formData.type}
                          onChange={e => setFormData({...formData, type: e.target.value})}
                        >
                          <option>PC</option>
                          <option>Laptop</option>
                          <option>Servidor</option>
                          <option>Periférico</option>
                        </select>
                      </div>
                      <div>
                         <label className="block text-sm text-gray-600 dark:text-gray-400 mb-1">Estado</label>
                        <select 
                          className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white outline-none"
                          value={formData.status}
                          onChange={e => setFormData({...formData, status: e.target.value})}
                        >
                          <option>Operativo</option>
                          <option>Asignado</option>
                          <option>Mantenimiento</option>
                          <option>Baja</option>
                        </select>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-600 dark:text-gray-400 mb-1">Número de Serie</label>
                      <input 
                        required
                        className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none"
                        value={formData.serialNumber}
                        onChange={e => setFormData({...formData, serialNumber: e.target.value})}
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-600 dark:text-gray-400 mb-1">Ubicación</label>
                      <input 
                        required
                        className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none"
                        value={formData.location}
                        onChange={e => setFormData({...formData, location: e.target.value})}
                      />
                    </div>

                    <div className="pt-4 flex gap-3">
                      <button 
                        type="button"
                        onClick={closeModal}
                        className="flex-1 px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
                      >
                        Cancelar
                      </button>
                      <button 
                        type="submit"
                        className="flex-1 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-md"
                      >
                        {editingId ? 'Actualizar' : 'Guardar'}
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
          </div>
        );
      };

      // --- Main APP ---
      const App = () => {
        const [user, setUser] = useState(null);

        return (
          <>
            {!user ? (
              <LoginPage onLogin={setUser} />
            ) : (
              <Dashboard user={user} onLogout={() => setUser(null)} />
            )}
          </>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>